---
title: "Extending climaemet"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Extending climaemet}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
resource_files:
   - vignettes/example-gif.gif
---

<!-- extending-climaemet.Rmd is generated from extending-climaemet.Rmd.orig. Please edit that file -->



**climaemet** provides several functions for accessing a selection of endpoints
of the [AEMET API tool](https://opendata.aemet.es/dist/index.html?). However,
this package does not cover in full all the capabilities of the API.

For that reason, we provide the `get_data_aemet()` function, that allows to
access any API endpoint freely. The drawback is that the user would need to
handle the results by him/herself.


``` r
library(climaemet)
```

## Example: Normalized text

Some API endpoints, as `predicciones-normalizadas-texto`, provides the results
as plain text on natural language. These results are not parsed by
**climaemet**, but can be retrieved as this:


``` r
# endpoint, today forecast

today <- "/api/prediccion/nacional/hoy"

# Metadata
knitr::kable(get_metadata_aemet(today))
```



|unidad_generadora                           |descripcion                                                                                                                              |periodicidad                                                                                                                                                                                                               |formato   |copyright                                                                                               |notaLegal                          |
|:-------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Predicción de Referencia |Predicción general nacional para hoy / mañana / pasado mañana / medio plazo (tercer y cuarto día) / tendencia (del quinto al noveno día) |Disponibilidad. Para hoy, solo se confecciona si hay cambios significativos. Para mañana y pasado mañana diaria a las 15:00 h.o.p.. Para el medio plazo diaria a las 16:00 h.o.p.. La tendencia, diaria a las 18:30 h.o.p. |ascii/txt |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



``` r

# Data
pred_today <- get_data_aemet(today)
#> 
#> Results are MIME type: text/plain
#> Returning data as string
```


``` r
# Produce a result

clean <- gsub("\r", "\n", pred_today, fixed = TRUE)
clean <- gsub("\n\n\n", "\n", clean, fixed = TRUE)

cat(paste("---\n\n", clean, "\n---"))
```

---

 AGENCIA ESTATAL DE METEOROLOGÍA
PREDICCIÓN GENERAL PARA ESPAÑA 
DÍA 02 DE FEBRERO DE 2025 A LAS 09:02 HORA OFICIAL
PREDICCIÓN VÁLIDA PARA EL DOMINGO 2

A.- FENÓMENOS SIGNIFICATIVOS
Acumulados significativos de nieve en el oeste de la Cordillera
Cantábrica y localmente en el sistema Central y el norte de la
meseta Norte. Abundantes precipitaciones en el entorno
cantábrico. Heladas significativas en el Pirineo y sistema
Ibérico. Intervalos de fuerte y/o rachas muy fuertes en litorales
de Galicia, Cantábrico, de alisio en Canarias. Probables
intervalos de fuerte en Alborán, Ampurdán y norte de Baleares.

B.- PREDICCIÓN
Se prevé que la Península se vea afectada por la llegada de un
frente atlántico que dejará abundante nubosidad y
precipitaciones en el cuadrante noroeste así como, de forma más
abundante, en el entorno cantábrico. Existe una elevada
incertidumbre en cuanto a su evolución, haciendo que no se
descarten las lluvias en otros puntos de la Península, siendo
menos probables en el tercio este. Por otro lado se prevé que
persistan las bajas presiones en el Mediterráneo dejando
chubascos ocasionalmente acompañados de tormenta en Baleares y
Melilla. Se prevén nevadas en las montañas de cuadrante
noroeste, con acumulados significativos en el oeste de la
cordillera Cantábrica, norte de la meseta Norte y otros puntos de
la meseta próximos al Sistema Central. La cota irá bajando de
1600/1400 metros hasta el entorno de los 1200/1000 m, aunque en
algunas zonas de la meseta Norte puede bajar hasta 800. También
es probable la nieve en la sierra de Mallorca a una cota de
1200/1400 m. Brumas y bancos de niebla en las depresiones del
noreste. En Canarias, predominio de cielos nubosos con
precipitaciones débiles especialmente en el norte de las islas
montañosas. Las temperaturas máximas aumentarán en Pirineos y
norte del área mediterránea y habrá descensos en el resto de la
mitad norte peninsular, moderados en el interior de la meseta
Norte. Las mínimas descenderán en Galicia, Cantábrico y tercio
nordeste, con aumentos en el extremo suroeste peninsular y
Alborán. Pocos cambios en el resto. Heladas en la mayor parte de
interiores de la mitad este peninsular, zonas de la meseta Norte y
montañas del cuadrante noreste, significativas en el Pirineo y
sistema Ibérico. Se espera un predominio de los vientos de
componentes norte y oeste en la Península y Baleares, con
intervalos de fuerte y/o rachas muy fuertes en litorales de
Galicia, Cantábrico y probables en Alborán, Ampurdán y norte de
Baleares. En Canarias soplará el alisio con intervalos de fuerte,
con rachas muy fuertes en zonas expuestas.

 
---

## Example: Maps

AEMET also provides map data, usually on `image/gif` format. One way to get this
kind of data is as follows:


``` r
# Endpoint of a map
a_map <- "/api/mapasygraficos/analisis"

# Metadata
knitr::kable(get_metadata_aemet(a_map))
```



|unidad_generadora                 |descripción                                |periodicidad                                                                              |formato   |copyright                                                                                               |notaLegal                          |
|:---------------------------------|:------------------------------------------|:-----------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Jefes de Turno |Mapas de análisis de frentes en superficie |Dos veces al día, a las 02:00 y 14:00 h.o.p. en invierno y a las 03:00 y 15:00 en verano. |image/gif |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



``` r

the_map <- get_data_aemet(a_map)
#> 
#> Results are MIME type: image/gif
#> Returning raw data


# Write as gif and include it
giffile <- "example-gif.gif"
writeBin(the_map, giffile)

# Display on the vignette
knitr::include_graphics(giffile)
```

<div class="figure">
<img src="example-gif.gif" alt="Example: Surface analysis map provided by AEMET" width="100%" />
<p class="caption">Example: Surface analysis map provided by AEMET</p>
</div>
