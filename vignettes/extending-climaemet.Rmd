---
title: "Extending climaemet"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Extending climaemet}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
resource_files:
   - vignettes/example-gif.gif
---

<!-- extending-climaemet.Rmd is generated from extending-climaemet.Rmd.orig. Please edit that file -->



**climaemet** provides several functions for accessing a selection of endpoints
of the [AEMET API tool](https://opendata.aemet.es/dist/index.html?). However,
this package does not cover in full all the capabilities of the API.

For that reason, we provide the `get_data_aemet()` function, that allows to
access any API endpoint freely. The drawback is that the user would need to
handle the results by him/herself.


``` r
library(climaemet)
```

## Example: Normalized text

Some API endpoints, as `predicciones-normalizadas-texto`, provides the results
as plain text on natural language. These results are not parsed by
**climaemet**, but can be retrieved as this:


``` r
# endpoint, today forecast

today <- "/api/prediccion/nacional/hoy"

# Metadata
knitr::kable(get_metadata_aemet(today))
```



|unidad_generadora                           |descripcion                                                                                                                              |periodicidad                                                                                                                                                                                                               |formato   |copyright                                                                                               |notaLegal                          |
|:-------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Predicción de Referencia |Predicción general nacional para hoy / mañana / pasado mañana / medio plazo (tercer y cuarto día) / tendencia (del quinto al noveno día) |Disponibilidad. Para hoy, solo se confecciona si hay cambios significativos. Para mañana y pasado mañana diaria a las 15:00 h.o.p.. Para el medio plazo diaria a las 16:00 h.o.p.. La tendencia, diaria a las 18:30 h.o.p. |ascii/txt |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



``` r

# Data
pred_today <- get_data_aemet(today)
#> 
#> Results are MIME type: text/plain
#> Returning data as string
```


``` r
# Produce a result

clean <- gsub("\r", "\n", pred_today, fixed = TRUE)
clean <- gsub("\n\n\n", "\n", clean, fixed = TRUE)

cat(paste("---\n\n", clean, "\n---"))
```

---

 AGENCIA ESTATAL DE METEOROLOGÍA
PREDICCIÓN GENERAL PARA ESPAÑA 
DÍA 30 DE JULIO DE 2025 A LAS 12:57 HORA OFICIAL
PREDICCIÓN VÁLIDA PARA EL MIÉRCOLES 30

A.- FENÓMENOS SIGNIFICATIVOS
Precipitaciones localmente fuertes en el este de Cataluña y en el
oeste de Baleares. Temperaturas máximas que superarán los 36-40
grados en los valles del Guadiana y Guadalquivir y puntos del
Miño. Mínimas que no bajarán de 25 grados en puntos del litoral
sudeste y Pitiusas. Intervalos de viento fuerte en litorales
gallegos, Ampurdán, Baleares y el Estrecho.

B.- PREDICCIÓN
Se prevé un predominio de cielos poco nubosos o despejados, salvo
en el Cantábrico donde, bajo un flujo de componente norte, se
esperan intervalos de nubes bajas y precipitaciones, persistentes
en el Cantábrico oriental. Además, se prevé inestabilidad con
chubascos en zonas de Baleares y el nordeste peninsular, más
intensos, incluso localmente fuertes, en el este de Cataluña y el
oeste de Baleares. Asimismo, se espera nubosidad de evolución
dispersa y no se descartan tormentas secas por la tarde en zonas
de montaña de Andalucía. En Canarias se esperan intervalos de
nubes bajas en los nortes de las islas montañosas.

Probables bancos de niebla o brumas matinales en interior y zonas
altas del extremo norte e interior sudeste, y aisladamente en
litorales del área mediterránea norte.

Temperaturas máximas con pocos cambios o en aumento ligero a
moderado en Península y Baleares, pudiendo ser localmente notable
en el sur de Huelva, mientras en Canarias se inicia un descenso.
Se superarán 34-36 grados en el interior sudoeste peninsular y
valle del Miño, y los 36-39 grados en los valles del Guadiana y
Guadalquivir. Mínimas en descenso en Sierra Morena y las Canarias
montañosas, en aumento en el Estrecho y Sistema Central y sin
cambios en el resto, permaneciendo por encima de 25 grados en
puntos del litoral sureste y Pitiusas.

Soplará levante con intervalos de fuerte en Alborán y Estrecho
con probables rachas muy fuertes en zonas expuestas. En el área
mediterránea oriental predominará la componente norte con
intervalos de fuerte en Ampurdán y Menorca, así como variables o
de componente este en otras zonas de la fachada mediterránea. En
el resto de la Península soplarán vientos flojos en general con
predominio de la componente norte, cierzo en el Ebro y el nordeste
en las costas gallegas, donde localmente se espera algún
intervalo de fuerte. En Canarias soplará un alisio moderado,
tendiendo a flojo de norte.

 
---

## Example: Maps

AEMET also provides map data, usually on `image/gif` format. One way to get this
kind of data is as follows:


``` r
# Endpoint of a map
a_map <- "/api/mapasygraficos/analisis"

# Metadata
knitr::kable(get_metadata_aemet(a_map))
```



|unidad_generadora                 |descripción                                |periodicidad                                                                              |formato   |copyright                                                                                               |notaLegal                          |
|:---------------------------------|:------------------------------------------|:-----------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Jefes de Turno |Mapas de análisis de frentes en superficie |Dos veces al día, a las 02:00 y 14:00 h.o.p. en invierno y a las 03:00 y 15:00 en verano. |image/gif |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



``` r

the_map <- get_data_aemet(a_map)
#> 
#> Results are MIME type: image/gif
#> Returning raw data


# Write as gif and include it
giffile <- "example-gif.gif"
writeBin(the_map, giffile)

# Display on the vignette
knitr::include_graphics(giffile)
```

<div class="figure">
<img src="example-gif.gif" alt="Example: Surface analysis map provided by AEMET" width="100%" />
<p class="caption">Example: Surface analysis map provided by AEMET</p>
</div>
