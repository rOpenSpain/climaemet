---
title: "Extending climaemet"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Extending climaemet}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
resource_files:
   - vignettes/example-gif.gif
---

<!-- extending-climaemet.Rmd is generated from extending-climaemet.Rmd.orig. Please edit that file -->



**climaemet** provides several functions for accessing a selection of endpoints
of the [AEMET API tool](https://opendata.aemet.es/dist/index.html?). However,
this package does not cover in full all the capabilities of the API.

For that reason, we provide the `get_data_aemet()` function, that allows to
access any API endpoint freely. The drawback is that the user would need to
handle the results by him/herself.


``` r
library(climaemet)
```

## Example: Normalized text

Some API endpoints, as `predicciones-normalizadas-texto`, provides the results
as plain text on natural language. These results are not parsed by
**climaemet**, but can be retrieved as this:


``` r
# endpoint, today forecast

today <- "/api/prediccion/nacional/hoy"

# Metadata
knitr::kable(get_metadata_aemet(today))
```



|unidad_generadora                           |descripcion                                                                                                                              |periodicidad                                                                                                                                                                                                               |formato   |copyright                                                                                               |notaLegal                          |
|:-------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Predicción de Referencia |Predicción general nacional para hoy / mañana / pasado mañana / medio plazo (tercer y cuarto día) / tendencia (del quinto al noveno día) |Disponibilidad. Para hoy, solo se confecciona si hay cambios significativos. Para mañana y pasado mañana diaria a las 15:00 h.o.p.. Para el medio plazo diaria a las 16:00 h.o.p.. La tendencia, diaria a las 18:30 h.o.p. |ascii/txt |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



``` r

# Data
pred_today <- get_data_aemet(today)
#> ℹ Results are MIME type: "text/plain".
#> → Returning data as UTF-8 string.
```


``` r
# Produce a result

clean <- gsub("\r", "\n", pred_today, fixed = TRUE)
clean <- gsub("\n\n\n", "\n", clean, fixed = TRUE)

cat(paste("---\n\n", clean, "\n---"))
```

---

 AGENCIA ESTATAL DE METEOROLOGÍA
PREDICCIÓN GENERAL PARA ESPAÑA 
DÍA 11 DE ENERO DE 2026 A LAS 08:29 HORA OFICIAL
PREDICCIÓN VÁLIDA PARA EL DOMINGO 11

A.- FENÓMENOS SIGNIFICATIVOS
Probables rachas muy fuertes de componente oeste de madrugada en
el bajo Ebro y en Pirineos y del suroeste al final del día en
zonas expuestas de Galicia y la Cordillera Cantábrica. Ascenso
notable de las temperaturas máximas en el Cantábrico, alto Ebro
y en montañas del norte.

B.- PREDICCIÓN
Se espera que el acercamiento de las altas presiones provoque una
estabilización, salvo en el noroeste peninsular, que quedará
bajo un flujo atlántico. Cielos muy nubosos o cubiertos en la
mitad noroeste, nubosos en el resto y tendiendo a despejar, salvo
nubosidad alta. Se esperan precipitaciones en el noroeste y oeste
del Sistema Central, sin descartar que sean persistentes en el
oeste de Galicia. En el resto de la mitad noroeste y en el norte
de Baleares no se descarta alguna precipitación débil y
ocasional. En Canarias, intervalos nubosos sin descartar alguna
lluvia débil en las islas occidentales.

Brumas y nieblas matinales en zonas de la vertiente atlántica,
más persistentes en áreas de montaña del noroeste.

Temperaturas máximas en ascenso, salvo ligeros descensos en el
oeste de depresiones de la meseta sur y Guadalquivir. El ascenso
podrá ser notable en el Cantábrico, alto Ebro y en montañas del
norte. Pocos cambios en Baleares. Mínimas en ascenso en Galicia,
y en el resto en ligero descenso, más acusado en Baleares y
depresiones del noreste. En Canarias, pocos cambios, salvo ligeros
ascensos de las máximas. Heladas moderadas en Pirineos, débiles
en zonas de montaña y aledañas de la meseta y en las sierras del
sudeste.

Viento del suroeste moderado en el noroeste y la meseta norte, con
rachas muy fuertes en zonas expuestas de Galicia y la Cordillera
Cantábrica. En el nordeste, predominio de la componente oeste con
intervalos de fuerte y rachas muy fuertes en zonas expuestas de
Pirineos, Ampurdán y bajo Ebro, tendiendo a amainar. Viento flojo
en la meseta sur y en Andalucía. Soplará moderado de sur con
intervalos de fuerte en litorales cantábricos, del oeste en
Alborán y del noroeste en el resto del área mediterránea,
rolando a suroeste. En Canarias, viento del nordeste moderado.

 
---

## Example: Maps

AEMET also provides map data, usually on `image/gif` format. One way to get this
kind of data is as follows:


``` r
# Endpoint of a map
a_map <- "/api/mapasygraficos/analisis"

# Metadata
knitr::kable(get_metadata_aemet(a_map))
```



|unidad_generadora                 |descripción                                |periodicidad                                                                              |formato   |copyright                                                                                               |notaLegal                          |
|:---------------------------------|:------------------------------------------|:-----------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Jefes de Turno |Mapas de análisis de frentes en superficie |Dos veces al día, a las 02:00 y 14:00 h.o.p. en invierno y a las 03:00 y 15:00 en verano. |image/gif |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



``` r

the_map <- get_data_aemet(a_map)
#> ℹ Results are MIME type: "image/gif".
#> → Returning <raw> bytes. See also `base::writeBin()`.


# Write as gif and include it
giffile <- "example-gif.gif"
writeBin(the_map, giffile)

# Display on the vignette
knitr::include_graphics(giffile)
```

<div class="figure">
<img src="example-gif.gif" alt="Example: Surface analysis map provided by AEMET" width="100%" />
<p class="caption">Example: Surface analysis map provided by AEMET</p>
</div>
