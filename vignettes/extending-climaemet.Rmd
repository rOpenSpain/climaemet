---
title: "Extending climaemet"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Extending climaemet}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
resource_files:
   - vignettes/example-gif.gif
---

<!-- extending-climaemet.Rmd is generated from extending-climaemet.Rmd.orig. Please edit that file -->



**climaemet** provides several functions for accessing a selection of endpoints
of the [AEMET API tool](https://opendata.aemet.es/dist/index.html?). However,
this package does not cover in full all the capabilities of the API.

For that reason, we provide the `get_data_aemet()` function, that allows to
access any API endpoint freely. The drawback is that the user would need to
handle the results by him/herself.


``` r
library(climaemet)
```

## Example: Normalized text

Some API endpoints, as `predicciones-normalizadas-texto`, provides the results
as plain text on natural language. These results are not parsed by
**climaemet**, but can be retrieved as this:


``` r
# endpoint, today forecast

today <- "/api/prediccion/nacional/hoy"

# Metadata
knitr::kable(get_metadata_aemet(today))
```



|unidad_generadora                           |descripcion                                                                                                                              |periodicidad                                                                                                                                                                                                               |formato   |copyright                                                                                               |notaLegal                          |
|:-------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Predicción de Referencia |Predicción general nacional para hoy / mañana / pasado mañana / medio plazo (tercer y cuarto día) / tendencia (del quinto al noveno día) |Disponibilidad. Para hoy, solo se confecciona si hay cambios significativos. Para mañana y pasado mañana diaria a las 15:00 h.o.p.. Para el medio plazo diaria a las 16:00 h.o.p.. La tendencia, diaria a las 18:30 h.o.p. |ascii/txt |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



``` r

# Data
pred_today <- get_data_aemet(today)
#> ℹ Results are MIME type: "text/plain".
#> → Returning data as UTF-8 string.
```


``` r
# Produce a result

clean <- gsub("\r", "\n", pred_today, fixed = TRUE)
clean <- gsub("\n\n\n", "\n", clean, fixed = TRUE)

cat(paste("---\n\n", clean, "\n---"))
```

---

 AGENCIA ESTATAL DE METEOROLOGÍA
PREDICCIÓN GENERAL PARA ESPAÑA 
DÍA 16 DE DICIEMBRE DE 2025 A LAS 08:51 HORA OFICIAL
PREDICCIÓN VÁLIDA PARA EL MARTES 16

A.- FENÓMENOS SIGNIFICATIVOS
Chubascos fuertes y/o persistentes acompañados de tormenta y
ocasionalmente granizo en la fachada oriental peninsular y
Asturias, así como a primeras horas en el norte de Galicia,
Cádiz, Ceuta, Alborán y zonas del Pirineo. Probables
acumulaciones significativas de nieve en cotas altas del Sistema
Central. Nieblas densas en zonas de montaña de la mitad norte.

B.- PREDICCIÓN
Un frente atlántico, unido a la formación de un sistema de bajas
presiones al sureste de la Península dejarán cielos nubosos o
cubiertos con precipitaciones generalizadas en la Península y
Baleares, tendiendo en general a menos de oeste a este. Se prevén
fuertes y/o persistentes en la fachada oriental peninsular y
Asturias, así como a primeras horas en el norte de Galicia,
Cádiz, Ceuta, Alborán y zonas del Pirineo, pudiendo darse
también chubascos localmente fuertes en zonas aledañas del
Cantábrico e islas Pitiusas, o ser persistentes en el Sistema
Central. Con incertidumbre, los mayores acumulados se prevén en
el entorno de Castellón y sur de Tarragona, y se espera que vayan
con tormenta y probable granizo ocasional en regiones del
Mediterráneo y en el Estrecho. Cota de nieve: 1500/1800 metros,
bajando a 1300/1600 m. en el cuadrante noroeste con probables
acumulados significativos en el Sistema Central. La cola del
frente también llegará a Canarias, con cielos nubosos y
precipitaciones débiles en los nortes de las islas.

Bancos de niebla en entornos de montaña e interiores del tercio
este peninsular.

Salvo algunos aumentos en el entorno pirenaico, Ampurdán, sur de
Galicia y noroeste de Castilla y León, las temperaturas máximas
descenderán en la Península y Baleares, con pocos cambios en
Canarias. Mínimas en aumento en la meseta Norte y nordeste de la
Sur, en descenso en Andalucía y Mediterráneo y pocos cambios en
el resto. Heladas débiles en entornos de montaña.

Soplará poniente con intervalos fuertes en el Estrecho y
Alborán, con viento moderado del norte en Galicia con intervalos
fuertes en litorales, del sur y oeste rolando a norte y oeste en
el Cantábrico y del suroeste en Baleares y litorales del sureste
peninsular. Viento flojo de componente sur y este en el resto,
rolando a norte y oeste en la mitad occidental peninsular y
arreciando el este en el Levante. Viento moderado del norte en
Canarias arreciando a fuerte con probables rachas muy fuertes.

 
---

## Example: Maps

AEMET also provides map data, usually on `image/gif` format. One way to get this
kind of data is as follows:


``` r
# Endpoint of a map
a_map <- "/api/mapasygraficos/analisis"

# Metadata
knitr::kable(get_metadata_aemet(a_map))
```



|unidad_generadora                 |descripción                                |periodicidad                                                                              |formato   |copyright                                                                                               |notaLegal                          |
|:---------------------------------|:------------------------------------------|:-----------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Jefes de Turno |Mapas de análisis de frentes en superficie |Dos veces al día, a las 02:00 y 14:00 h.o.p. en invierno y a las 03:00 y 15:00 en verano. |image/gif |© AEMET. Autorizado el uso de la información y su reproducción citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



``` r

the_map <- get_data_aemet(a_map)
#> ℹ Results are MIME type: "image/gif".
#> → Returning <raw> bytes. See also `base::writeBin()`.


# Write as gif and include it
giffile <- "example-gif.gif"
writeBin(the_map, giffile)

# Display on the vignette
knitr::include_graphics(giffile)
```

<div class="figure">
<img src="example-gif.gif" alt="Example: Surface analysis map provided by AEMET" width="100%" />
<p class="caption">Example: Surface analysis map provided by AEMET</p>
</div>
