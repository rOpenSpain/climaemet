---
title: "Extending climaemet"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Extending climaemet}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
resource_files:
   - vignettes/example-gif.gif
---

<!-- extending-climaemet.Rmd is generated from extending-climaemet.Rmd.orig. Please edit that file -->



**climaemet** provides several functions for accessing a selection of endpoints
of the [AEMET API tool](https://opendata.aemet.es/dist/index.html?). However,
this package does not cover in full all the capabilities of the API.

For that reason, we provide the `get_data_aemet()` function, that allows to
access any API endpoint freely. The drawback is that the user would need to
handle the results by him/herself.


``` r
library(climaemet)
```

## Example: Normalized text

Some API endpoints, as `predicciones-normalizadas-texto`, provides the results
as plain text on natural language. These results are not parsed by
**climaemet**, but can be retrieved as this:


``` r
# endpoint, today forecast

today <- "/api/prediccion/nacional/hoy"

# Metadata
knitr::kable(get_metadata_aemet(today))
```



|unidad_generadora                           |descripcion                                                                                                                              |periodicidad                                                                                                                                                                                                               |formato   |copyright                                                                                               |notaLegal                          |
|:-------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de PredicciÃ³n de Referencia |PredicciÃ³n general nacional para hoy / maÃ±ana / pasado maÃ±ana / medio plazo (tercer y cuarto dÃ­a) / tendencia (del quinto al noveno dÃ­a) |Disponibilidad. Para hoy, solo se confecciona si hay cambios significativos. Para maÃ±ana y pasado maÃ±ana diaria a las 15:00 h.o.p.. Para el medio plazo diaria a las 16:00 h.o.p.. La tendencia, diaria a las 18:30 h.o.p. |ascii/txt |Â© AEMET. Autorizado el uso de la informaciÃ³n y su reproducciÃ³n citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



``` r

# Data
pred_today <- get_data_aemet(today)
#> â„¹ Results are MIME type: "text/plain".
#> â†’ Returning data as UTF-8 string.
```


``` r
# Produce a result

clean <- gsub("\r", "\n", pred_today, fixed = TRUE)
clean <- gsub("\n\n\n", "\n", clean, fixed = TRUE)

cat(paste("---\n\n", clean, "\n---"))
```

---

 AGENCIA ESTATAL DE METEOROLOGÃA
PREDICCIÃ“N GENERAL PARA ESPAÃ‘A 
DÃA 19 DE ENERO DE 2026 A LAS 09:12 HORA OFICIAL
PREDICCIÃ“N VÃLIDA PARA EL LUNES 19

A.- FENÃ“MENOS SIGNIFICATIVOS
Precipitaciones fuertes y persistentes en Baleares y extremo
nordeste peninsular, sobre todo en Girona. Nevadas con importantes
acumulados que pueden afectar a los Pirineos orientales y, a
Ãºltimas horas, a la IbÃ©rica oriental. Viento fuerte con rachas
muy fuertes del este y nordeste al final del dÃ­a en el litoral
catalÃ¡n y en Baleares. En Canarias viento del nordeste fuerte con
rachas muy fuertes.

B.- PREDICCIÃ“N
El paso de una dana hacia el MediterrÃ¡neo junto con la formaciÃ³n
de la borrasca Harry al norte de Argelia dejarÃ¡ una situaciÃ³n
muy inestable en el MediterrÃ¡neo occidental, con un temporal que
afectarÃ¡ al nordeste peninsular y a Baleares. Asimismo, un frente
atlÃ¡ntico dejarÃ¡ precipitaciones en los litorales atlÃ¡nticos,
afectando a Galicia y al CantÃ¡brico. Se esperan precipitaciones,
sobre todo, en el nordeste y Baleares, sin descartarlas de forma
dÃ©bil en el Sistema Central e IbÃ©ricas y de forma aislada en la
Meseta. Los mayores acumulados serÃ¡n en el nordeste peninsular y
Baleares, con precipitaciones muy fuertes y persistentes,
especialmente en Girona. Se esperan nevadas en los sistemas
montaÃ±osos, que serÃ¡n dÃ©biles en los del centro y norte, con
una cota en torno a 1000-1200 m y nevadas que tendrÃ¡n acumulados
muy importantes en el Pirineo oriental por encima de 1400-1600 m y
al final en la IbÃ©rica este con una cota a 1100-1300 m. En
Canarias, cielos nubosos con precipitaciones en los nortes.

Brumas y nieblas en zonas de montaÃ±a del norte, que pueden ser
persistentes en el Pirineo oriental. Bancos de niebla matinales en
la meseta norte.

Temperaturas mÃ¡ximas en descenso en el noroeste y montaÃ±as del
este, y en ascenso en el arco mediterrÃ¡neo, oeste de las mesetas
y el Ebro. Sin cambios o descensos puntuales en el resto. MÃ­nimas
en ligero descenso en el nordeste, valles del suroeste y en el
CantÃ¡brico. Pocos cambios en Canarias. Heladas dÃ©biles en los
sistemas montaÃ±osos peninsulares y localmente en la meseta,
moderadas en cumbres.

Viento del norte y oeste flojo en el interior de la PenÃ­nsula. En
los litorales atlÃ¡ntico y mediterrÃ¡neo, viento moderado de
componente norte que rolarÃ¡ a fuerte del este al norte de
Baleares y en AmpurdÃ¡n, originando un temporal marÃ­timo con
rachas muy fuertes en la costa. En el Golfo de CÃ¡diz y AlborÃ¡n,
poniente con intervalos de fuerte en AlborÃ¡n. En Canarias, alisio
moderado con intervalos de fuerte y rachas muy fuertes.

 
---

## Example: Maps

AEMET also provides map data, usually on `image/gif` format. One way to get this
kind of data is as follows:


``` r
# Endpoint of a map
a_map <- "/api/mapasygraficos/analisis"

# Metadata
knitr::kable(get_metadata_aemet(a_map))
```



|unidad_generadora                 |descripciÃ³n                                |periodicidad                                                                              |formato   |copyright                                                                                               |notaLegal                          |
|:---------------------------------|:------------------------------------------|:-----------------------------------------------------------------------------------------|:---------|:-------------------------------------------------------------------------------------------------------|:----------------------------------|
|Grupo Funcional de Jefes de Turno |Mapas de anÃ¡lisis de frentes en superficie |Dos veces al dÃ­a, a las 02:00 y 14:00 h.o.p. en invierno y a las 03:00 y 15:00 en verano. |image/gif |Â© AEMET. Autorizado el uso de la informaciÃ³n y su reproducciÃ³n citando a AEMET como autora de la misma. |https://www.aemet.es/es/nota_legal |



``` r

the_map <- get_data_aemet(a_map)
#> â„¹ Results are MIME type: "image/gif".
#> â†’ Returning <raw> bytes. See also `]8;;x-r-help:base::writeBinbase::writeBin]8;;()`.


# Write as gif and include it
giffile <- "example-gif.gif"
writeBin(the_map, giffile)

# Display on the vignette
knitr::include_graphics(giffile)
```

<div class="figure">
<img src="example-gif.gif" alt="Example: Surface analysis map provided by AEMET" width="100%" />
<p class="caption">Example: Surface analysis map provided by AEMET</p>
</div>
